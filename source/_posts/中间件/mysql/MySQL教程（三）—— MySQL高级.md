---
title: MySQL教程（三）—— MySQL高级
date: 2023年5月17日20:13:44
tags: 
    - MySQL
categories: 中间件
keywords:
description: 
top_img: https://img1.baidu.com/it/u=950222251,316656728&fm=253&fmt=auto&app=138&f=JPG?w=967&h=500
comments:
cover: https://img1.baidu.com/it/u=950222251,316656728&fm=253&fmt=auto&app=138&f=JPG?w=967&h=500
toc: 
toc_number:
toc_style_simple:
copyright:
copyright_author:
copyright_author_href:
copyright_url:
copyright_info:
mathjax:
katex:
aplayer:
highlight_shrink:
aside:

---

<meta name="referrer" content="no-referrer"/>

# 存储引擎

## MySQL体系结构

![image-20230517202515022](https://typora-md-bucket.oss-cn-beijing.aliyuncs.com/image-20230517202515022.png)

- 连接层：最上层是一些客户端和连接服务，主要完成一些类似于连接处理、授权认证、以及相关的安全方案。服务器也会为安全接入的每个客户端验证它所具有的操作权限。
- 服务层：第二层架构主要完成大多数的核心服务功能，如SQL接口，并完成缓存的查询，SQL的分析和优化，部分内置函数的执行。所有跨存储引擎的功能也在这一层实现，如存储过程、函数等。
- 引擎层：存储引擎真正的负责了MySQL中数据的存储和提起，服务器通过API和存储引擎进行通信。不同的存储引擎具有不同的功能，这样我们可以根据自己的需要，来选取合适的存储引擎。
- 存储层：主要是将数据(如: redolog、undolog、数据、索引、二进制日志、错误日志、查询日志、慢查询日志等)存储在文件系统之上，并完成与存储引擎的交互。

> 和其他数据库相比，MySQL有点与众不同，它的架构可以在多种不同场景中应用并发挥良好作用。主要体现在存储引擎上，**插件式的存储引擎架构，将查询处理和其他的系统任务以及数据的存储提取分离。**这种架构可以根据业务的需求和实际需要选择合适的存储引擎。

> 需要注意的是，**索引**的实现是基于存储引擎的，也就意味着不同的存储引擎其索引的实现方式是截然不同的。

## 存储引擎简介

> 存储引擎就是存储数据、建立索引、更新/查询数据等技术的实现方式。存储引擎是基于表的，而不是基于库的，也就是说一个数据库中存在的多张表可以使用不同的存储引擎。我们可以在创建表的时候，来指定选择的存储引擎，如果没有指定将自动选择默认的存储引擎InnoDB。

```mysql
#创建表时，指定存储引擎

CREATE TABLE 表名(
	字段....
)ENGINE = 引擎;
```

实例：

```mysql
#创建表my_myisam并指定MyISAM存储引擎

CREATE TABLE my_myisam(
	id int,
	name varchar(10)
)ENGINE = MYISAM;

#创建表my_memory并指定Memory存储引擎

CREATE TABLE my_memory(
	id int,
	name varchar(10)
)ENGINE = MEMORY;
```

如果需要查看MySQL支持哪些存储引擎，可以使用`SHOW ENGINES` 查看：

![image-20230517203410418](https://typora-md-bucket.oss-cn-beijing.aliyuncs.com/image-20230517203410418.png)

## InnoDB

> 介绍：
>
> - InnoDB是一种兼顾高可靠性和高性能的通用存储引擎，在 MySQL 5.5 之后，InnoDB是默认的MySQL 存储引擎。

> 特点：
>
> - DML操作遵循ACID模型，支持`事务`；
> - 支持`行级锁`，提高并发访问性能；
> - 支持`外键FOREIGN KEY约束`，保证数据的完整性和正确性；

> 文件：
>
> - xxx.ibd：xxx代表的是表名，innoDB引擎的每张表都会对应这样一个表空间文件，存储该表的表结构（frm-早期的 、sdi-新版的）、数据和索引。

逻辑存储结构：

![image-20220912113910358](https://img-blog.csdnimg.cn/img_convert/f41c4939c8563f98cdbb2f069657ecaa.png)

- 表空间 : InnoDB存储引擎逻辑结构的最高层，ibd文件其实就是表空间文件，在表空间中可以包含多个Segment段。
- 段 : 表空间是由各个段组成的， 常见的段有数据段、索引段、回滚段等。InnoDB中对于段的管理，都是引擎自身完成，不需要人为对其控制，一个段中包含多个区。
- 区 : 区是表空间的单元结构，每个区的大小为<font color='red'>1M</font>。 默认情况下， InnoDB存储引擎页大小为16K， 即一个区中一共有64个连续的页。
- 页 : 页是组成区的最小单元，**页也是InnoDB存储引擎磁盘管理的最小单元**，每个页的大小默认为 <font color='red'>16KB</font>。为了保证页的连续性，InnoDB 存储引擎每次从磁盘申请 4-5 个区。
- 行 : InnoDB 存储引擎是面向行的，也就是说数据是按行进行存放的，在每一行中除了定义表时所指定的字段以外，还包含两个隐藏字段(后面会详细介绍)。

## MyISAM

介绍：

- MyISAM时MySQL早期的默认存储引擎。

特点：

- 不支持事务，不支持外键
- 支持表锁，不支持行锁
- 访问速度快

文件：

- xxx.sdi：存储表结构信息
- xxx.MYD：存储数据
- xxx.MYI：存储索引

## Memory

介绍：

- Memory引擎的表数据是存放在内存中的，由于受到硬件问题或断电问题的影响，只能将这些表作为临时表或缓存使用。

特点：

- 内存存放
- hash索引（默认）

文件：

- xxx.sdi：存储表结构信息

| 特点         | InnoDB       | MyISAM | Memory |
| ------------ | ------------ | ------ | ------ |
| 存储限制     | 64TB         | 有     | 有     |
| 事务安全     | 支持         | -      | -      |
| 锁           | 行级锁       | 表级锁 | 表级锁 |
| B+Tree索引   | 支持         | 支持   | 支持   |
| Hash索引     | -            | -      | 支持   |
| 全文索引     | 支持（5.6+） | 支持   | -      |
| 空间使用     | 高           | 低     | N/A    |
| 内存使用     | 高           | 低     | 中等   |
| 批量插入速度 | 低           | 高     | 高     |
| 外键         | 支持         | -      | -      |

## 存储引擎选择

在选择存储引擎时，应该根据应用系统的特点选择合适的存储引擎。对于复杂的应用系统，还可以根据实际情况选择多种存储引擎进行组合。

- **InnoDB**: 是Mysql的默认存储引擎，支持事务、外键、行级锁。如果应用对事务的完整性有比较高的要求，在并发条件下要求数据的一致性，数据操作除了插入和查询之外，还包含很多的更新、删除操作，那么InnoDB存储引擎是比较合适的选择。
- MyISAM ： 如果应用是以读操作和插入操作为主，只有很少的更新和删除操作，并且对事务的完整性、并发性要求不是很高，那么选择这个存储引擎是非常合适的。
- MEMORY：将所有数据保存在内存中，访问速度快，通常用于临时表及缓存。MEMORY的缺陷就是对表的大小有限制，太大的表无法缓存在内存中，而且无法保障数据的安全性。

# 索引

















